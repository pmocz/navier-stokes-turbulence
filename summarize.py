import numpy as np
import matplotlib.pyplot as plt
import argparse

"""
Philip Mocz (2025), @pmocz

Summaize processed simulation results as a function of resolution.
This script is designed to be run after the `analyze.py` script has been executed for
each resolution. It will load the results from the `results.npz` files generated by
`analyze.py` and plot the results.

"""


parser = argparse.ArgumentParser(
    description="Summarize Navier-Stokes Simulation Results"
)
parser.add_argument("--show", action="store_true", help="Show plots interactively")
args = parser.parse_args()


def summarize_results(resolutions):
    """
    Summarize results from multiple resolutions.

    Parameters:
    resolutions (list): List of resolutions to summarize.
    """
    fig = plt.figure(figsize=(8, 6))

    for res in resolutions:
        data = np.load(f"checkpoints{res}/results.npz")
        k = data["k"]
        Pf_all = data["Pf_all"]

        # Plot the power spectra
        for i in range(Pf_all.shape[0]):
            Pf = Pf_all[i]
            plt.plot(
                k, Pf, label=f"Resolution {res} (Checkpoint {i})", linewidth=res / 64
            )

    plt.xlabel("Wavenumber (k)")
    plt.ylabel("Power Spectrum")
    plt.xscale("log")
    plt.yscale("log")
    plt.ylim([1.0e-11, 1.0e-1])
    plt.savefig("summary.png")
    if args.show:
        plt.show()
    plt.close(fig)


if __name__ == "__main__":
    # Define the resolutions to summarize
    resolutions = [32, 64, 128]  # Add more resolutions as needed

    # Call the summarization function
    summarize_results(resolutions)
